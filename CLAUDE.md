# CLAUDE.md

## 目的
このファイルは Claude Code の作業方針とプロジェクト固有ルールを示します。

## 判断記録のルール
- 判断内容の要約を記載する
- 検討した代替案を列挙する
- 採用しなかった案とその理由を明記する
- 前提条件・仮定・不確実性を明示する
- 他エージェントによるレビュー可否を示す

## プロジェクト概要
- 目的: VRCX の SQLite データベースを API として公開するウェブサーバー
- 主な機能: テーブル一覧取得、レコード取得（ページネーション対応）、静的ファイルの配信

## 重要ルール
- 会話言語: 日本語
- コミット規約: Conventional Commits
- コメント言語: 日本語
- エラーメッセージ: 英語
- 日本語と英数字の間には半角スペースを挿入する

## 環境のルール
- ブランチ命名: Conventional Branch (`feat/`, `fix/` 等の短縮形を使用)
- GitHub リポジトリ調査: 必要に応じてテンポラリディレクトリに clone して検索
- Renovate PR: 自動生成された PR に追加コミットや更新を行わない

## コード改修時のルール
- エラーメッセージの絵文字統一: 既存のメッセージに絵文字がある場合は、内容に即した絵文字を先頭に付与する
- TypeScript: `skipLibCheck` の使用を禁止
- ドキュメント: 関数・インターフェースに JSDoc を日本語で記載する

## 開発コマンド
```bash
# インストール
pnpm install

# 開発
pnpm dev

# ビルド
pnpm build

# Lint
pnpm lint

# 修正
pnpm fix
```

## アーキテクチャと主要ファイル
- `src/main.ts`: エントリーポイント
- `src/server.ts`: Fastify アプリケーションの構築
- `src/environments.ts`: 環境変数の管理
- `src/endpoints/`: API エンドポイントの定義
  - `index.ts`: 基底クラス `BaseRouter`
  - `api.ts`: VRCX データベース操作 API
  - `root.ts`: ルートおよび静的ファイル配信

## 実装パターン
- `BaseRouter` を継承して新しいエンドポイントを追加する
- データベース接続は `better-sqlite3` を使用し、原則 readonly でオープンする

## 作業チェックリスト

### 新規改修時
1. プロジェクトを理解する
2. 適切な作業ブランチを作成する
3. 最新のリモートブランチに基づいているか確認する
4. 不要なブランチを削除する
5. `pnpm install` を実行する

### コミット・プッシュ前
1. Conventional Commits に従っているか確認する
2. センシティブな情報が含まれていないか確認する
3. `pnpm lint` でエラーがないか確認する
4. 動作確認を行う

### PR 作成前
1. ユーザーから PR 作成の依頼があるか確認する
2. コンフリクトの恐れがないか確認する

### PR 作成後
1. コンフリクトが発生していないか確認する
2. PR 本文を日本語で、最新の状態のみを詳しく記載する
3. `gh pr checks` で CI の成功を確認する
4. Copilot レビュー等の指摘に対応する
